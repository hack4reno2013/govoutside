var govOutsideWidget={};(function(){thisApp=this;this.api_key=null;this.host="govoutside.com";this.target=document.getElementById("go-root");this.endpoint=null;this.map=null;this.markers=[];this.mapData=null;this.locations=null;this.categories=null;this.colors=null;this.widgetContainer=null;this.mapContainer=null;this.sidebarContainer=null;this.locationsList=null;this.topbarContainer=null;this.categoriesList=null;this.stylesLoaded=false;this.activeLocation=null;this.activeCategory=null;this.init=function(e,t){this.api_key=e;if(typeof t!=="undefined"){this.endpoint=t}if(this.target==null){console.log("error: missing go-root element");return}this.loadStylesheet();if(typeof google=="undefined"||typeof google.maps=="undefined"){this.loadGoogle()}else{this.getMapData()}};this.loadStylesheet=function(){var e;var t=document;var n=this;e=t.createElement("link");e.type="text/css";e.async=true;e.rel="stylesheet";e.href="//"+this.host+"/assets/styles/widget.css";e.onload=function(){n.stylesLoaded=true};document.getElementsByTagName("head")[0].appendChild(e)};this.loadGoogle=function(){var e;var t=document;e=t.createElement("script");e.type="text/javascript";e.async=true;e.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"+"&callback=govOutsideWidget.getMapData";t.getElementsByTagName("head")[0].appendChild(e)};this.getMapData=function(){var e=this;var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==4&&t.status==200){var n=t.responseText;var r=JSON.parse(n);if(typeof r=="object"){e.mapData=r;e.createMap()}else{console.log("error: invalid json response")}}};var n="//"+this.host+"/?view=ajax&api_key="+this.api_key;if(this.endpoint!==null){n=this.endpoint}t.open("GET",n,true);t.send()};this.getInitOptions=function(){if(typeof this.mapData.init!=="undefined"){if(typeof this.mapData.init.center!=="undefined"){var e=this.mapData.init.center;this.mapData.init.center=this.getLatLngObject(e.lat,e.lng)}return this.mapData.init}else{return{}}};this.getLocations=function(){if(typeof this.mapData.locations=="object"&&this.mapData.locations.length>0){return this.mapData.locations}else{return[]}};this.getColors=function(){if(typeof this.categories=="object"&&this.categories.length>0){colors={};for(var e=0;e<this.categories.length;e++){colors[this.categories[e].slug]=this.categories[e].color}return colors}else{return[]}};this.getCategories=function(){if(typeof this.mapData.categories=="object"&&this.mapData.categories.length>0){var e=[{slug:"all",title:"All",color:"#3d62a6"}];for(var t=0;t<this.mapData.categories.length;t++){e.push(this.mapData.categories[t])}return e}else{return[]}};this.getLatLngObject=function(e,t){return new google.maps.LatLng(e,t)};this.createMap=function(){var e=this;var t=setInterval(function(){if(e.stylesLoaded){clearInterval(t);e.widgetContainer=e.appendElement("div","m-go-widget h-group",e.target);e.topbarContainer=e.appendElement("div","m-go-topbar",e.widgetContainer);e.categoriesList=e.appendElement("ul","",e.topbarContainer);e.mapContainer=e.appendElement("div","m-go-map",e.widgetContainer);e.sidebarContainer=e.appendElement("div","m-go-sidebar",e.widgetContainer);e.locationsList=e.appendElement("ul","",e.sidebarContainer);var n=e.getInitOptions();e.map=new google.maps.Map(e.mapContainer,n);e.locations=e.getLocations();e.categories=e.getCategories();e.colors=e.getColors();e.plotLocations();e.populateTopbar();e.populateSidebar()}},20)};this.plotLocations=function(){var e=0;var t=this.locations;var n=t.length;var r=new google.maps.LatLngBounds;var i=this;while(e<n){var s=t[e];var o=this.getLatLngObject(s.lat,s.lng);r.extend(o);var u=new google.maps.Marker({position:o,map:this.map,title:s.title,icon:this.getSvgIcon(this.colors[s.category])});u.location_index=e;u.category=s.category;this.markers.push(u);google.maps.event.addListener(u,"click",function(e,t){return function(){i.onLocationClick(t)}}(u,e));e++}this.map.fitBounds(r);this.map.panToBounds(r)};this.getSvgIcon=function(e){return{path:"M 100 0 L 0 0 L 0 100 L 35 100 L 50 120 L 65 100 L 100 100 Z",fillColor:e,fillOpacity:1,strokeColor:"",strokeWeight:1,scale:1/3}};this.populateTopbar=function(){var e=this;for(var t=0;t<this.categories.length;t++){var n=this.categories[t];var r={"data-category":n.slug,style:"background-color: "+n.color+"; border-color: "+n.color};var i="";if(n.slug=="all"){i="active"}var s=this.appendElement("li",i,this.categoriesList,n.title,r);var o=this.appendElement("div","arrow",s);s.onclick=function(t){e.onCategoryClick(this.getAttribute("data-category"))}}this.activeCategory="all"};this.populateSidebar=function(){var e=this;var t=this.locations;for(var n=0;n<t.length;n++){var r=this.locations[n];var i={"data-location-index":n,"data-category":r.category};var s=this.appendElement("li","",this.locationsList,"",i);var o=this.appendElement("h1","",s,t[n].title);var u=this.appendElement("p","",s,t[n].desc);s.onclick=function(t){e.onLocationClick(this.getAttribute("data-location-index"))}}this.activeLocation=-1};this.appendElement=function(e,t,n,r,i){if(typeof e=="undefined"){e="div"}var s=document.createElement(e);if(typeof t!=="undefined"){s.className=t}if(typeof n!=="undefined"){n.appendChild(s)}if(typeof r!=="undefined"){s.innerHTML=r}if(typeof i=="object"){for(var o in i){s.setAttribute(o,i[o])}}return s};this.onLocationClick=function(e){this.activeCategory=e;this.setSidebarLocationActive(e);this.setMapLocationActive(e)};this.setSidebarLocationActive=function(e){e=String(e);for(var t=0;t<this.locationsList.childNodes.length;t++){var n=this.locationsList.childNodes[t];var r=n.getAttribute("data-location-index");if(r===e){this.addClass(n,"active")}else{this.removeClass(n,"active")}}};this.setMapLocationActive=function(e){for(var t=0;t<this.markers.length;t++){var n=this.markers[t];if(n.location_index==e){this.map.panTo(n.position)}}};this.onCategoryClick=function(e){if(e!==this.activeCategory){this.activeCategory=e;this.setSidebarLocationActive(-1);this.setTopbarLocationActive(e);this.filterSidebarByCategory(e);this.filterMapByCategory(e)}};this.setTopbarLocationActive=function(e){for(var t=0;t<this.categoriesList.childNodes.length;t++){var n=this.categoriesList.childNodes[t];var r=n.getAttribute("data-category");if(r===e){this.addClass(n,"active")}else{this.removeClass(n,"active")}}};this.filterSidebarByCategory=function(e){for(var t=0;t<this.locationsList.childNodes.length;t++){var n=this.locationsList.childNodes[t];var r=n.getAttribute("data-category");if(r==e||e=="all"){this.removeClass(n,"hidden")}else{this.addClass(n,"hidden")}}};this.filterMapByCategory=function(e){var t=new google.maps.LatLngBounds;for(var n=0;n<this.markers.length;n++){var r=this.markers[n];if(r.category==e||e=="all"){t.extend(r.position);r.setMap(this.map)}else{r.setMap(null)}}this.map.fitBounds(t);this.map.panToBounds(t)};this.hasClass=function(e,t){return(new RegExp(" "+t+" ")).test(" "+e.className+" ")};this.addClass=function(e,t){e.className+=" "+t};this.removeClass=function(e,t){var n=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(this.hasClass(e,t)){while(n.indexOf(" "+t+" ")>=0){n=n.replace(" "+t+" "," ")}e.className=n.replace(/^\s+|\s+$/g,"")}}}).apply(govOutsideWidget);